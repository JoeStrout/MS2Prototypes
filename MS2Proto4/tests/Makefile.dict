# Makefile for CS_Dictionary unit tests

CXX = g++
CC = gcc
CXXFLAGS = -std=gnu++11 -Wall -Wextra -g
CFLAGS = -Wall -Wextra -g
INCLUDES = -I../cpp/core

# Core directory
CORE_DIR = ../cpp/core

# C++ sources (CS_Dictionary is header-only, but needs CS_String)
CXX_SOURCES = \
	$(CORE_DIR)/CS_String.cpp \
	test_CS_Dictionary.cpp

# C sources (String dependencies)
C_SOURCES = \
	$(CORE_DIR)/StringStorage.c \
	$(CORE_DIR)/unicodeUtil.c \
	$(CORE_DIR)/hashing.c

# Object files
CXX_OBJECTS = $(CXX_SOURCES:.cpp=.o)
C_OBJECTS = $(C_SOURCES:.c=.o)
ALL_OBJECTS = $(CXX_OBJECTS) $(C_OBJECTS)

# Output binary
TARGET = test_CS_Dictionary

# Default target
all: $(TARGET)

$(TARGET): $(ALL_OBJECTS)
	@echo "Linking..."
	$(CXX) $(CXXFLAGS) $(ALL_OBJECTS) -o $(TARGET)
	@echo "Build complete: ./$(TARGET)"

# C++ compilation
%.o: %.cpp
	@echo "Compiling $<..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# C compilation
%.o: %.c
	@echo "Compiling $<..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

# Run tests
test: $(TARGET)
	@echo "Running tests..."
	@./$(TARGET)

# Clean
clean:
	rm -f $(TARGET) $(ALL_OBJECTS)
	@echo "Clean complete"

.PHONY: all test clean
